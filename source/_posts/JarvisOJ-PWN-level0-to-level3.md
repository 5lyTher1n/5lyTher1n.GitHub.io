---
title: JarvisOJ_PWN_from_level0_to_level3
date: 2019-11-17 22:12:27
tags:
- Sec
- CTF
- PWN
- JarvisOJ
categories:
- Sec
- CTF
- PWN
---
# 花絮 #
好久没更新Blog了，加上换了电脑，都忘记更新Blog的方法了。

一直在做课程的作业加折腾别的，刷OJ学安全这些正事反而少了很多。这段时间学习PWN的基本内容，反正是要记录的，~~加上想起来了Github的密码~~，就记录在Blog上吧0.0

之前只跟着视频和PDF做了下SeeD的实验内容，但是觉得，只是知道了简单的原理，实验里的操作方式又觉得过于理想化。所以找到一个CTFOJ：JarvisOJ做做题，来学习下各种基本手法和套路。

这应该算是做的前四题PWN的题目0=0
所以几乎全部都看了WP后才做的
毕竟都不会。。。
<!-- more -->
# Level 0#
## 独立解题 ##
啥都不会，工具也不知道用什么，独立不出来，直接去找题解。
## 题解 ##
1. 使用IDA打开文件。
在String里查看，找到了system('/bin/sh'）双击后，进入可以看到地址。
2. 在vulnerable_function里看到buf后边写了长度，然后函数命令里的长度超过了buf的长度，存在栈溢出
3. 前边的用‘a’填充后在RTN的位置上填上system的地址。

# Level1 #
## 独立解题 ##
- 查看栈空间，发现存在栈溢出。
- 查看string，没有找到/bin/sh等内容

OK，卡壳。不知道怎么利用了。。。
## 题解 ##
1. 查看checksec，发现是32位。看到NX保护是关闭的，了解到NX保护关闭时可以执行栈内的代码。
2. %p 输出是指针，可以利用这个地址作为rtn。直接先键入shellcode再填充就好了
3. 这题比较像SeeD的实验题目，但是那个%p一开始不知道是什么，也不知道怎么利用。 

# Level2 #
## 独立解题 ##
- checksec，32位。NX打开。所以不能像上一题在栈内填充shellcode
- 查看代码，vulnerable_function存在栈溢出
- 查看string。里面有/bin/sh。双击跟进，模仿level0的方式，把/bin/sh的地址填入到rtn里。发现出错。
## 题解 ##
1. 一个误解，不是有了/bin/sh的字符串就可以直接利用的，仔细看下第一题，那是system('/bin/sh'),是调用了system函数，以字符串为参数才可以。
2. 一个常识，之前好像看到这个知识点，但最后忘记了。在32位里，参数是通过压栈的方式传递。在64位里好像是用到的寄存器。
3. 直接rnt到一个a函数，下一个填充的是a函数结束后跳转到的位置，然后在栈地址减小的方向，从左往右的参数(这好像是栈帧的结构？又记不清楚了)。
4. 利用pwntools里的工具，search和symbols可以找到system函数地址和‘/bin/sh’的地址。构造payload就可以了

# Level3 #
## 独立解题 ##
和上一题很相似，但是内部没有system函数和shell字符串。卡壳
## 题解 ##
1. 忘记了还有库这种东西，仔细看看解压完成后，还有一个libc-2.19.so的文件。这题倒是让我想起了之前看的Whatsapp那个漏洞。
2. 知道了点GOT表这个东西，存放了函数运行时的真实内存地址。同时，两个函数在库里的偏移量与内存中真实内存地址的偏移量相等。这个知识点在了解时发现好像CSAPP里有，可我没看到那个地方。
3. IDA看代码时发现，里面有write函数。学习到了，可以利用write函数进行第一次溢出产生内存泄漏，输出write函数在运行时的内存地址,write函数有3个参数，第一个是FD，这里用1，表示标准输出。第二个参数是输出的 内容，这里就是got['write'];第三个参数是输出大小，4个字节？可以输出8位，也就是内存地址了。当write函数结束时返回到vulnerable_function，再进行下一次的溢出。
4. 二次溢出。在（3）中读取到内存地址后，在libc的库里找到write、system、shell字符串的地址，利用偏移量相等可以计算出运行后两者时内存地址。
5. 构造payload

# 总结 #
这四题大概是两天写的，都写完后根据整理的草稿睡前整理的文章。

写的太乱而且也不详细，不觉得别人看了有什么用，因为是草稿，大概只是记录了自己的疑问和注意点，比较适合我自己去回顾，相比之下，之前Web类的题目可能还对人有些帮助。

- 没有介绍太多工具的使用，但其实在整个过程中发现，对IDA、pwntools、gdb的使用都很不足，这些工具真的要能掌握好，做到熟练使用，工欲善其事必先利其器。
- 之前打算看CSAPP。但是真的很纠结于细枝末节，导致整个进度都很慢，而且容易断。查资料的过程中加上之前看到的经验贴，都提到了这本书的重要性，尽量在2019年把这本书给过一遍，可以不熟练，但是要有比较好的印象。


整理些在做题中遇到的问题吧：

- IDA是7.0版本，之前整理了7.2版本但是32位版本好像没办法F5，所以用的是7.0版本，使用在Windows 8.1的虚拟机里，好像也可以在Linux环境下使用，但是，现在不太想折腾，就算了。~反正又不是不能用.jpg~
- pwntools好像没办法在win下使用，所以在Ubuntu 16.04里
- 看到的很多题解的python代码是2.7版本的。我的环境是3.5.2在使用他们的代码时发现，bytes是一个比较常见的问题。在我使用时，需要对str进行encode函数转换成bytes。在做level1时想到了SeeD里提到到spray方法，就是填充NOP。但是对\x90进行encode时会多出来一个\xc2的字符。搜了下好像暂时没解决。是之后想起来pwntools介绍里提到nop的操作，发现好像可以用asm('nop')实现spray。

整理的很乱，但是大多数主要的点算是记录了下来，也方便之后自己看，我把‘显示更多’放在正文之前。
之后整理文章应该会更科学更方便观看吧，加油！

**人一我百，人十我万，永不放弃，加油！**